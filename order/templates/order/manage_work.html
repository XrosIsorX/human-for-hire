{% extends 'hello/base.html' %}

{% block content %}
<h3>My Work</h3>
<!-- current work: the start date hasn't come yet -->
<h4>Current Work</h4>

<table class="table" id="hh-managework">
	<thead>
		<th>Employer</th>
		<th>Descriptions</th>
		<th>Date</th>
		<th>Price</th>
		<th></th>
	</thead>
	<tbody>
	{% if work_list %}
		{% for work in work_list %}
			<tr>
			<td>{{work.buyer_username}}</td>
			<td>{{work.detail}}</td>
			<td>{{work.start_date}}</td>
			<td>{{work.price}} THB</td>
		    <td order="{{work.order_no}}" class="manage-status__{{work.get_status_display|cut:" "}}">{{work.get_status_display}}</td> 
			</tr>
		{% endfor %}
	{% endif %}
	    <tr>
	      <td>Kritsana</td>
	      <td>สอนหนังสือภาษาอังกฤษ</td>
	      <td>20 Oct 2017</td>
	      <td>2800 THB</td>
	      <!-- Hover to show the button that can click to confirm -->
	      <td class="manage-status__TOBEACCEPTED">TO BE ACCEPTED</td> 
	    </tr>
	    <tr>
	      <td>Kritsana</td>
	      <td>สอนหนังสือภาษาอังกฤษ</td>
	      <td>20 Oct 2017</td>
	      <td>2800 THB</td>
	      <td class="manage-status__WAITINGFORWORK">WAITING FOR WORK DONE</td>
	    </tr>
	</tbody>
</table>
<!-- past work: the start date has passed -->
<h4>Past Work</h4>
<table class="table" id="hh-managework">
	<thead>
		<th>Employer</th>
		<th>Descriptions</th>
		<th>Date</th>
		<th>Price</th>
		<th></th>
	</thead>
	<tbody>
	    <tr>
	      <td>Kritsana</td>
	      <td>สอนหนังสือภาษาอังกฤษ</td>
	      <td>20 Oct 2017</td>
	      <td>2800 THB</td>
	      <!-- Hover to show the button that can click to update staus work done -->
	      <td class="manage-status__WAITINGFORWORK">WAITING FOR WORK DONE</td>
	    </tr>
	    <tr>
	      <td>Kritsana</td>
	      <td>สอนหนังสือภาษาอังกฤษ</td>
	      <td>20 Oct 2017</td>
	      <td>2800 THB</td>
	      <td class="manage-status__FAILED">FAILED</td>
	    </tr>
	    <tr>
	      <td>Kritsana</td>
	      <td>สอนหนังสือภาษาอังกฤษ</td>
	      <td>20 Oct 2017</td>
	      <td>2800 THB</td>
	      <td class="manage-status__CANCELLED">CANCELLED</td>
	    </tr>
	    <tr>
	      <td>Kritsana</td>
	      <td>สอนหนังสือภาษาอังกฤษ</td>
	      <td>20 Oct 2017</td>
	      <td>2800 THB</td>
	      <td class="manage-status__WORKDONE">WORK DONE</td>
	    </tr>
	</tbody>
</table>
<script type="text/javascript">
	$(".manage-status__TOBEACCEPTED").hover(
		function() {
			$(this).addClass('accept-hover');
		    $(this).text("ACCEPT");
		}, function() {
			$(this).text("TO BE ACCEPTED");
		}
    );
	$(".manage-status__WAITINGFORWORK").hover(
		function() {
			$(this).addClass('workdone-hover');
		    $(this).text("MARK AS DONE");
		}, function() {
			$(this).text("WAITING FOR WORK DONE");
		}
    );
	$(".manage-status__WAITSELLERMARKDONE").hover(
		function() {
			$(this).addClass('workdone-hover');
		    $(this).text("MARK AS DONE");
		}, function() {
			$(this).text("WAIT SELLER MARK DONE");
		}
    );
	$(".manage-status__TOBEACCEPTED").click(function(){
		var element = this
		$.ajax({
			url: '/ajax/accept_work',
			data: {
				'order_no': $(this).attr('order')
			},
			dataType: 'json',
			success: function(data) {
				if(data.success) {
					$(element).attr("class", "manage-status__ACCEPTED");
					$(element).unbind();
					$(element).text("ACCEPTED!")
				}
			}
		});
	});
	function confirm_workdone(){
		element = this
		$.ajax({
			url: '/ajax/seller_confirm_workdone',
			data: {
				'order_no': $(this).attr('order')
			},
			dataType: 'json',
			success: function(data) {
				if(data.success) {
					$(element).attr("class", "manage-status__WORKDONE");
					$(element).unbind();
					$(element).text("WORK DONE")
				}
			}
		});
	}
	$(".manage-status__WAITINGFORWORK").click(confirm_workdone);
	$(".manage-status__WAITSELLERMARKDONE").click(confirm_workdone);

</script>
{% endblock %}